#!/bin/bash

GATEKEEPER_PATH='<%= c['ruby.gatekeeper_app_path'] %>'
MEZURO_PATH='<%= c['ruby.mezuro_app_path'] %>'

set -e

copy_db_cfg()
{
    [ -f config/database.yml ] || cp config/database.yml{.sample,}
}

cd "$GATEKEEPER_PATH" && \
  copy_db_cfg

cd "$MEZURO_PATH" && \
  copy_db_cfg && \
  rake db:setup

service postgresql start
service tomcat6 start

cd "$GATEKEEPER_PATH" && \
  bundle exec rails s -d -p 8081

cd "$MEZURO_PATH" && \
  bundle exec rails s -d -p 3000
