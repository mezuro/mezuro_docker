#!/bin/bash

GATEKEEPER_PATH='<%= c['ruby.gatekeeper_app_path'] %>'
GATEKEEPER_PIDFILE="${GATEKEEPER_PATH}/kalibro_gatekeeper.pid"

MEZURO_PATH='<%= c['ruby.mezuro_app_path'] %>'
MEZURO_PIDFILE="${MEZURO_PATH}/mezuro.pid"

set -e

cd "$GATEKEEPER_PATH" && \
  cp config/database.yml.sample config/database.yml

cd "$MEZURO_PATH" && \
  cp config/database.yml.sample config/database.yml && \
  rake db:create && rake db:migrate

service postgresql start
service tomcat6 start

cd "$GATEKEEPER_PATH" && \
  bundle exec rails s -d -p 8081

cd "$MEZURO_PATH" && \
  bundle exec rails s -d -p 3000
