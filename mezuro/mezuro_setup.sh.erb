#!/bin/bash

GATEKEEPER_PATH=/home/mezuro/kalibro_gatekeeper
GATEKEEPER_SETUP=/home/mezuro/gatekeeper_setup.sh"

MEZURO_PATH=/home/mezuro/mezuro

set -e

copy_db_cfg()
{
  [ -f config/database.yml ] || cp config/database.yml{.sample,}
}

copy_tests_cfg()
{
  [ -f features/support/kalibro_cucumber_helpers.yml ] || cp features/support/kalibro_cucumber_helpers.yml{.sample,}
}

[ -x "$GATEKEEPER_SETUP"] && "$GATEKEEPER_SETUP"

cd "$MEZURO_PATH" \
 && copy_db_cfg \
 && copy_tests_cfg \
 && bundle install -j4 \
 && bundle exec rake db:setup