#!/bin/bash

GATEKEEPER_PATH='<%= c['ruby.gatekeeper_app_path'] %>'
GATEKEEPER_SETUP="$GATEKEEPER_PATH/setup.sh"
MEZURO_PATH='<%= c['ruby.mezuro_app_path'] %>'

set -e

copy_db_cfg()
{
  [ -f config/database.yml ] || cp config/database.yml{.sample,}
}

copy_tests_cfg()
{
  [ -f features/support/kalibro_cucumber_helpers.yml ] || cp features/support/kalibro_cucumber_helpers.yml{.sample,}
}

[ -x "$GATEKEEPER_SETUP"] && "$GATEKEEPER_SETUP"

cd "$MEZURO_PATH" && \
  copy_db_cfg && \
  copy_tests_cfg && \
  bundle exec rake db:setup